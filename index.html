<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>åŒ—æ­æ—…éŠè¡Œç¨‹åŠ©æ‰‹</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Tailwind Play CDN [web:39] -->
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

  <style type="text/tailwindcss">
    @theme {
      --color-nordic-bg: #FFF9E6;
      --color-nordic-card: #FFFFFF;
      --color-nordic-accent: #F4D06F;
      --color-nordic-accent-soft: #FAE2A9;
      --color-nordic-text: #2F3A4A;
      --color-nordic-muted: #A0A6B5;
    }
    .no-scrollbar::-webkit-scrollbar {
      display: none;
    }
    .no-scrollbar {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
  </style>

  <!-- Vue 3 CDN [web:35] -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

  <!-- Leaflet åœ°åœ– -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>

<body class="bg-[var(--color-nordic-bg)] text-[var(--color-nordic-text)]">
<div id="app" class="min-h-screen flex flex-col max-w-md mx-auto shadow-lg bg-[var(--color-nordic-bg)]">
  <!-- Header -->
  <header class="px-4 pt-4 pb-2 flex items-center justify-between">
    <div>
      <h1 class="text-xl font-semibold tracking-wide">åŒ—æ­æ—…éŠè¡Œç¨‹åŠ©æ‰‹</h1>
      <p class="text-xs text-[var(--color-nordic-muted)]">å†°å³¶ + èŠ¬è˜­ Â· è¡Œç¨‹ / åœ°åœ– / åˆ†å¸³</p>
    </div>
    <div class="flex items-center gap-2">
      <span class="text-xs text-[var(--color-nordic-muted)]">v0.2</span>
    </div>
  </header>

  <!-- æ—¥æœŸæ©«å‘é¸å–® -->
  <section class="px-4 pb-3">
    <div class="flex items-center justify-between mb-1">
      <span class="text-sm font-medium">é¸æ“‡æ—¥æœŸ</span>
      <span class="text-[10px] text-[var(--color-nordic-muted)]">å·¦å³æ»‘å‹•é¸æ“‡è¡Œç¨‹æ—¥</span>
    </div>
    <div class="flex gap-2 overflow-x-auto no-scrollbar pb-1">
      <button
        v-for="(day, index) in days"
        :key="day.id"
        @click="selectDay(index)"
        class="flex-shrink-0 px-3 py-2 rounded-2xl text-xs text-center transition-all duration-150"
        :class="selectedDayIndex === index
          ? 'bg-[var(--color-nordic-accent)] text-[var(--color-nordic-text)] shadow-sm'
          : 'bg-[var(--color-nordic-accent-soft)] text-[var(--color-nordic-muted)]'"
      >
        <div class="font-semibold">{{ day.label }}</div>
        <div class="text-[10px]">{{ day.date }}</div>
        <div class="text-[10px] truncate max-w-[80px]">{{ day.title }}</div>
      </button>
      <button
        @click="addDay"
        class="flex-shrink-0 px-3 py-2 rounded-2xl border border-dashed border-[var(--color-nordic-accent)] text-xs text-[var(--color-nordic-muted)]"
      >
        ï¼‹
      </button>
    </div>
  </section>

  <!-- Tabs -->
  <section class="px-4 pb-2">
    <div class="bg-[var(--color-nordic-card)] rounded-2xl p-1 flex text-xs shadow-sm">
      <button
        v-for="tab in tabs"
        :key="tab"
        @click="currentTab = tab"
        class="flex-1 py-2 rounded-2xl transition-all"
        :class="currentTab === tab
          ? 'bg-[var(--color-nordic-accent)] text-[var(--color-nordic-text)] font-semibold'
          : 'text-[var(--color-nordic-muted)]'"
      >
        {{ tab }}
      </button>
    </div>
  </section>

  <!-- å…§å®¹ -->
  <main class="flex-1 overflow-y-auto px-4 pb-4 space-y-3">
    <!-- è¡Œç¨‹ Tab -->
    <section v-if="currentTab === 'è¡Œç¨‹'">
      <div class="flex items-center justify-between mb-2">
        <div>
          <h2 class="text-sm font-semibold">{{ currentDay.label }} Â· {{ currentDay.title }}</h2>
          <p class="text-[11px] text-[var(--color-nordic-muted)]">{{ currentDay.date }}</p>
        </div>
        <button
          @click="addItemToSelectedDay"
          class="text-xs px-2 py-1 rounded-xl bg-[var(--color-nordic-accent)] text-[var(--color-nordic-text)]"
        >
          ï¼‹ æ–°å¢è¡Œç¨‹
        </button>
      </div>

      <div v-if="currentDay.items.length === 0" class="text-xs text-[var(--color-nordic-muted)]">
        å°šæœªæ–°å¢è¡Œç¨‹ï¼Œå¯ä»¥å…ˆåŠ å…¥ã€Œæ™‚é–“ / åœ°é» / å‚™è¨»ã€ï¼Œå¾ŒçºŒå†æ…¢æ…¢è£œã€‚
      </div>

      <div
        v-for="(item, idx) in currentDay.items"
        :key="item.id"
        class="bg-[var(--color-nordic-card)] rounded-2xl p-3 shadow-sm mb-2"
      >
        <div class="flex items-center justify-between mb-1">
          <div class="flex items-center gap-2">
            <input
              v-model="item.time"
              placeholder="æ™‚é–“ï¼Œä¾‹å¦‚ 09:00-11:00"
              class="text-xs border-0 bg-transparent focus:outline-none focus:ring-0 font-semibold"
            />
            <span class="text-[10px] text-[var(--color-nordic-muted)]">
              {{ item.type || 'è¡Œç¨‹' }}
            </span>
          </div>
          <button
            @click="removeItemFromSelectedDay(idx)"
            class="text-[10px] text-red-400"
          >
            åˆªé™¤
          </button>
        </div>

        <input
          v-model="item.place"
          placeholder="åœ°é»ï¼æ´»å‹•åç¨±"
          class="w-full text-xs border-0 bg-transparent focus:outline-none focus:ring-0 mb-1"
        />

        <textarea
          v-model="item.note"
          placeholder="å‚™è¨»ï¼šäº¤é€šæ–¹å¼ã€é ç´„ç·¨è™Ÿã€åƒä»€éº¼ã€è¦å¸¶ä»€éº¼..."
          rows="2"
          class="w-full text-[11px] border-0 bg-transparent focus:outline-none focus:ring-0 resize-none text-[var(--color-nordic-muted)]"
        ></textarea>

        <!-- å¤©æ°£è³‡è¨Š -->
        <div class="mt-2 flex items-center justify-between text-[11px] text-[var(--color-nordic-muted)]">
          <div class="flex items-center gap-1">
            <span class="inline-flex items-center justify-center w-5 h-5 rounded-full bg-[var(--color-nordic-accent-soft)]">
              ğŸŒ¤
            </span>
            <span v-if="item.weather && !item.weather.loading">
              {{ item.weather.temp }}Â°C Â· {{ item.weather.summary }}
            </span>
            <span v-else-if="item.weather && item.weather.loading">
              è®€å–å¤©æ°£ä¸­â€¦
            </span>
            <span v-else>
              å°šæœªå–å¾—å¤©æ°£
            </span>
          </div>
          <button
            @click="fetchWeatherForItem(item)"
            class="text-[10px] underline decoration-dotted"
          >
            æ›´æ–°å¤©æ°£
          </button>
        </div>
      </div>
    </section>

    <!-- åœ°åœ– Tab -->
    <section v-if="currentTab === 'åœ°åœ–'">
      <div class="flex items-center justify-between mb-2">
        <h2 class="text-sm font-semibold">åœ°åœ–èˆ‡å°èˆª</h2>
        <button
          @click="focusTodayOnMap"
          class="text-[10px] px-2 py-1 rounded-xl bg-[var(--color-nordic-accent)]"
        >
          é‡æ–°æ•´ç†é‡˜é»
        </button>
      </div>

      <div class="text-[11px] text-[var(--color-nordic-muted)] mb-1">
        æœƒå°‡ç•¶æ—¥æ‰€æœ‰è¡Œç¨‹åœ°é»é‡˜åœ¨åœ°åœ–ä¸Šï¼›è‹¥æœªè¨­å®šåº§æ¨™ï¼Œæš«æ™‚ä»¥éš¨æ©Ÿé»ç¤ºæ„ï¼Œå¯é€æ­¥æ”¹æˆçœŸå¯¦åº§æ¨™ã€‚
      </div>

      <div id="map" class="w-full h-64 rounded-2xl overflow-hidden shadow-sm"></div>
    </section>

    <!-- åˆ†å¸³ Tab -->
    <section v-if="currentTab === 'åˆ†å¸³'">
      <div class="mb-2">
        <h2 class="text-sm font-semibold mb-1">åˆ†å¸³èˆ‡åŒ¯ç‡æ›ç®—</h2>
        <p class="text-[11px] text-[var(--color-nordic-muted)]">
          è¼¸å…¥å¤–å¹£é‡‘é¡èˆ‡å¹£åˆ¥ï¼Œæœƒè‡ªå‹•æ›ç®—æˆæ–°å°å¹£ï¼ˆæš«ç”¨è‡ªè¨‚åŒ¯ç‡ï¼Œå¯æ¥å³æ™‚åŒ¯ç‡ APIï¼‰ã€‚[web:31]
        </p>
      </div>

      <div class="bg-[var(--color-nordic-card)] rounded-2xl p-3 shadow-sm space-y-2 mb-3">
        <div class="flex gap-2 items-center">
          <input
            v-model.number="fx.amount"
            type="number"
            min="0"
            placeholder="é‡‘é¡"
            class="flex-1 text-xs border rounded-xl px-2 py-1"
          />
          <select
            v-model="fx.currency"
            class="w-20 text-xs border rounded-xl px-2 py-1"
          >
            <option value="EUR">EUR</option>
            <option value="ISK">ISK</option>
            <option value="SEK">SEK</option>
          </select>
        </div>
        <div class="flex items-center justify-between text-[11px] text-[var(--color-nordic-muted)]">
          <span>åŒ¯ç‡ä¾†æºï¼šæš«ç”¨éœæ…‹ç¤ºæ„ï¼Œå¯æ¥å¤–éƒ¨åŒ¯ç‡ API</span>
          <button
            @click="convertToTwd"
            class="text-[10px] px-2 py-1 rounded-xl bg-[var(--color-nordic-accent)]"
          >
            æ›ç®—æˆ TWD
          </button>
        </div>
        <div v-if="fx.resultTwd !== null" class="text-xs font-semibold">
          ç´„ NT$ {{ fx.resultTwd.toLocaleString() }}
        </div>
      </div>

      <div class="bg-[var(--color-nordic-card)] rounded-2xl p-3 shadow-sm">
        <h3 class="text-xs font-semibold mb-1">ç°¡æ˜“åˆ†å¸³</h3>
        <div class="space-y-2 text-[11px]">
          <div class="flex gap-2 items-center">
            <input
              v-model.number="split.total"
              type="number"
              min="0"
              placeholder="ç¸½é‡‘é¡ï¼ˆTWDï¼‰"
              class="flex-1 text-xs border rounded-xl px-2 py-1"
            />
            <input
              v-model.number="split.people"
              type="number"
              min="1"
              placeholder="äººæ•¸"
              class="w-20 text-xs border rounded-xl px-2 py-1"
            />
          </div>
          <button
            @click="calcSplit"
            class="w-full text-[11px] py-1 rounded-xl bg-[var(--color-nordic-accent)]"
          >
            è¨ˆç®—æ¯äººæ‡‰ä»˜
          </button>
          <div v-if="split.perPerson !== null" class="text-xs font-semibold">
            æ¯äººç´„ NT$ {{ split.perPerson.toLocaleString() }}
          </div>
        </div>
      </div>
    </section>
  </main>
</div>

<script>
const { createApp } = Vue;

createApp({
  data() {
    return {
      tabs: ['è¡Œç¨‹', 'åœ°åœ–', 'åˆ†å¸³'],
      currentTab: 'è¡Œç¨‹',

      // å·²é å¡ 2/24â€“3/8 å†°å³¶ + èŠ¬è˜­è¡Œç¨‹
      days: [
        {
          id: 1,
          label: 'Day 1',
          date: '02/24',
          title: 'å°åŒ— â†’ å†°å³¶ï¼ˆè½‰æ©Ÿæ—¥ï¼‰',
          items: [
            {
              id: 101,
              time: 'å…¨æ—¥',
              place: 'å°åŒ— â†’ é¦–çˆ¾ â†’ èŠ¬è˜­ â†’ å†°å³¶',
              type: 'äº¤é€š',
              note: 'ç¢ºèªå„æ®µèˆªç­æ™‚é–“ã€è½‰æ©Ÿèˆªå»ˆèˆ‡æ˜¯å¦éœ€è¦é‡æ–°æ‰˜é‹è¡Œæã€‚',
              lat: null,
              lng: null,
              weather: null,
            },
          ],
        },
        {
          id: 2,
          label: 'Day 2',
          date: '02/25',
          title: 'æŠµé”é›·å…‹é›…æœªå…‹',
          items: [
            {
              id: 201,
              time: '09:00â€“12:00',
              place: 'å‡±å¤«æ‹‰ç¶­å…‹æ©Ÿå ´ â†’ é›·å…‹é›…æœªå…‹é£¯åº—',
              type: 'äº¤é€š',
              note: 'æŠµé”å†°å³¶å¾Œå…¥å¢ƒã€é ˜è¡Œæï¼Œæ­å·´å£«æˆ–æ¥é§å‰å¾€å¸‚å€é£¯åº—ï¼Œå…ˆå¯„æ”¾è¡Œæã€‚',
              lat: 63.985,   // KEF é™„è¿‘å¤§è‡´åº§æ¨™ [web:20]
              lng: -22.6056,
              weather: null,
            },
            {
              id: 202,
              time: '12:00â€“16:00',
              place: 'é›·å…‹é›…æœªå…‹å¸‚å€æ•£æ­¥',
              type: 'å¸‚å€',
              note: 'å»ºè­°è·¯ç·šï¼šå“ˆçˆ¾æ ¼æ—å§†æ•™å ‚ã€å¤ªé™½èˆªæµ·è€…é›•åƒã€èˆŠæ¸¯å€ã€Laugavegur é€›è¡—ã€‚',
              lat: 64.1466,
              lng: -21.9426,
              weather: null,
            },
            {
              id: 203,
              time: '16:00â€“16:30',
              place: 'é£¯åº— Check-in',
              type: 'ä½å®¿',
              note: 'è¾¦ç†å…¥ä½ã€ç¨ä½œä¼‘æ¯ã€‚',
              lat: 64.1466,
              lng: -21.9426,
              weather: null,
            },
            {
              id: 204,
              time: '17:00â€“18:30',
              place: 'æ™šé¤',
              type: 'é¤é£Ÿ',
              note: 'å¯ä»¥æ‰¾å¸‚å€é¤å»³æˆ–è¶…å¸‚ç°¡å–®åƒï¼Œé †ä¾¿è²·éš”å¤©è»Šç¨‹å°é»å¿ƒã€‚',
              lat: 64.1466,
              lng: -21.9426,
              weather: null,
            },
            {
              id: 205,
              time: '19:00â€“',
              place: 'é£¯åº—ä¼‘æ¯',
              type: 'ä¼‘æ¯',
              note: 'èª¿æ•´æ™‚å·®ï¼Œæ•´ç†éš”å¤©ä¸€æ—¥éŠéœ€è¦çš„è¡£ç‰©èˆ‡å™¨æã€‚',
              lat: 64.1466,
              lng: -21.9426,
              weather: null,
            },
          ],
        },
        {
          id: 3,
          label: 'Day 3',
          date: '02/26',
          title: 'æ–¯å¥ˆå±±åŠå³¶ä¸€æ—¥éŠ',
          items: [
            {
              id: 301,
              time: '08:00â€“08:30',
              place: 'é£¯åº—é–€å£æ¥é§',
              type: 'é›†åˆ',
              note: 'ç­‰å¾…æ–¯å¥ˆå±±åŠå³¶ä¸€æ—¥éŠå°ˆè»Šæ¥é€ï¼Œç¢ºèªå‡ºç™¼é»èˆ‡è¯çµ¡æ–¹å¼ã€‚',
              lat: 64.1466,
              lng: -21.9426,
              weather: null,
            },
            {
              id: 302,
              time: '08:30â€“20:00',
              place: 'æ–¯å¥ˆå±±åŠå³¶ä¸€æ—¥éŠ',
              type: 'è¡Œç¨‹',
              note: 'å…¸å‹æ™¯é»ï¼šæ•™æœƒå±±ã€é»‘æ²™ç˜ã€æ¼æ‘å°é®ç­‰ï¼Œä¾å¯¦éš›åœ˜é«”è·¯ç·šç‚ºæº–ã€‚[web:8]',
              lat: 64.9,
              lng: -23.7,
              weather: null,
            },
            {
              id: 303,
              time: '20:00â€“',
              place: 'è¿”å›é›·å…‹é›…æœªå…‹',
              type: 'äº¤é€š',
              note: 'å›åˆ°å¸‚å€é£¯åº—ï¼Œè¦–é«”åŠ›æ±ºå®šè¦ä¸è¦å†å‡ºå»è²·æ±è¥¿ã€‚',
              lat: 64.1466,
              lng: -21.9426,
              weather: null,
            },
          ],
        },
        {
          id: 4,
          label: 'Day 4',
          date: '02/27',
          title: 'å—éƒ¨ä¸‰æ—¥éŠ Day 1ï¼ˆé»ƒé‡‘åœˆï¼‹è—æ¹–ï¼‰',
          items: [
            {
              id: 401,
              time: '08:00â€“08:30',
              place: 'é£¯åº—æ¥é§å‡ºç™¼',
              type: 'é›†åˆ',
              note: 'é–‹å§‹å—éƒ¨ä¸‰æ—¥éŠï¼Œæº–å‚™å¥½è¡Œæï¼Œå¸¶é½Šä¿æš–è¡£ç‰©èˆ‡ç›¸æ©Ÿã€‚[web:5]',
              lat: 64.1466,
              lng: -21.9426,
              weather: null,
            },
            {
              id: 402,
              time: 'ä¸Šåˆ',
              place: 'è¾›æ ¼ç¶­åˆ©çˆ¾åœ‹å®¶å…¬åœ’',
              type: 'æ™¯é»',
              note: 'ä¸–ç•Œéºç”¢åœ°é»ï¼Œæ¿å¡Šè£‚ç¸«æ™¯è§€ï¼Œå¯ç°¡å–®æ­¥é“æ•£æ­¥æ‹ç…§ã€‚[web:3]',
              lat: 64.255,
              lng: -21.129,
              weather: null,
            },
            {
              id: 403,
              time: 'ä¸­åˆå‰å¾Œ',
              place: 'è“‹æ­‡çˆ¾åœ°ç†±å€ï¼ˆGeysirï¼Strokkurï¼‰',
              type: 'æ™¯é»',
              note: 'è§€è³ Strokkur é–“æ­‡æ³‰å™´ç™¼ï¼Œè¨˜å¾—æ³¨æ„é¢¨å¹å‘é¿å…è¢«æ°´å™´åˆ°ã€‚[web:3]',
              lat: 64.3104,
              lng: -20.3024,
              weather: null,
            },
            {
              id: 404,
              time: 'ä¸‹åˆ',
              place: 'é»ƒé‡‘ç€‘å¸ƒï¼ˆGullfossï¼‰',
              type: 'æ™¯é»',
              note: 'è‘—åå¤§ç€‘å¸ƒï¼Œå†¬å¤©è·¯é¢å¯èƒ½çµå†°ï¼Œèµ°è·¯è¦å°å¿ƒã€‚[web:3]',
              lat: 64.3275,
              lng: -20.1218,
              weather: null,
            },
            {
              id: 405,
              time: 'å‚æ™šï½æ™šä¸Š',
              place: 'è—æ¹–æº«æ³‰',
              type: 'æº«æ³‰',
              note: 'é ç´„æ™‚æ®µç‚ºæº–ï¼Œè¨˜å¾—å¸¶æ³³è¡£èˆ‡é˜²æ°´åŒ…ã€‚æ³¡å®Œç›´æ¥é€å¾€ä½å®¿é£¯åº—ã€‚[web:1]',
              lat: 63.8804,
              lng: -22.4495,
              weather: null,
            },
          ],
        },
        {
          id: 5,
          label: 'Day 5',
          date: '02/28',
          title: 'å—éƒ¨ä¸‰æ—¥éŠ Day 2ï¼ˆç€‘å¸ƒï¼‹å†°å·ï¼‰',
          items: [
            {
              id: 501,
              time: 'æ—©ä¸Š',
              place: 'å¡é‡Œé›…è˜­ç€‘å¸ƒï¼ˆSeljalandsfossï¼‰',
              type: 'æ™¯é»',
              note: 'å¯ä»¥èµ°åˆ°ç€‘å¸ƒå¾Œæ–¹çš„ç¶“å…¸é»ï¼Œä½†å†¬å¤©åœ°é¢æ¿•æ»‘ï¼Œé›ªåœ°é‹å¾ˆé‡è¦ã€‚[web:3]',
              lat: 63.6156,
              lng: -19.9928,
              weather: null,
            },
            {
              id: 502,
              time: 'ä¸Šåˆï½ä¸­åˆ',
              place: 'æ–¯ç§‘åŠ ç€‘å¸ƒï¼ˆSkÃ³gafossï¼‰',
              type: 'æ™¯é»',
              note: 'å¯ä»¥èµ°æ¨“æ¢¯åˆ°ä¸Šæ–¹è§€æ™¯å°ï¼Œå¤©æ°£å¥½æ™‚å¸¸æœ‰å½©è™¹ã€‚[web:3]',
              lat: 63.5321,
              lng: -19.511,
              weather: null,
            },
            {
              id: 503,
              time: 'ä¸‹åˆ',
              place: 'ç´¢çˆ¾é»‘é¦¬å†°å·æˆ–æ–¯å¡å¤«å¡”å†°å·å¥è¡Œ',
              type: 'æ´»å‹•',
              note: 'ä¾ä½ é è¨‚çš„åœ˜æ±ºå®šå†°å·åœ°é»ï¼Œè¨˜å¾—æ‰‹å¥—ã€å¸½å­ã€ä¿æš–å±¤èˆ‡ç›¸æ©Ÿé›»æ± å‚™ä»½ã€‚[web:4]',
              lat: 63.530,
              lng: -19.363,
              weather: null,
            },
            {
              id: 504,
              time: 'å‚æ™š',
              place: 'å—å²¸å°é®ä½å®¿',
              type: 'ä½å®¿',
              note: 'æŠµé”æ²¿é€”å°é®é£¯åº—ï¼Œæ™šä¸Šç•™æ„æ˜¯å¦å¯ç›´æ¥çœ‹åˆ°æ¥µå…‰ã€‚',
              lat: 63.8,
              lng: -18.0,
              weather: null,
            },
          ],
        },
        {
          id: 6,
          label: 'Day 6',
          date: '03/01',
          title: 'å—éƒ¨ä¸‰æ—¥éŠ Day 3ï¼ˆå†°æ²³æ¹–ï¼‹è—å†°æ´ï¼‰',
          items: [
            {
              id: 601,
              time: 'æ—©ä¸Š',
              place: 'å‚‘å¤æ²™é¾å†°æ²³æ¹–ï¼ˆJÃ¶kulsÃ¡rlÃ³nï¼‰',
              type: 'æ™¯é»',
              note: 'æ¬£è³æ¼‚æµ®å†°å±±èˆ‡å¯èƒ½å‡ºç¾çš„æµ·è±¹ï¼Œæ³¨æ„ä¿æš–èˆ‡é˜²é¢¨ã€‚[web:4]',
              lat: 64.048,
              lng: -16.179,
              weather: null,
            },
            {
              id: 602,
              time: 'æ—©ä¸Šï½ä¸­åˆ',
              place: 'é‘½çŸ³æ²™ç˜ï¼ˆDiamond Beachï¼‰',
              type: 'æ™¯é»',
              note: 'é»‘æ²™ç˜ä¸Šæ•£è½é€æ˜å†°å¡Šï¼Œå¾ˆé©åˆæ‹ç…§ï¼Œå°å¿ƒå¤§æµªã€‚[web:4]',
              lat: 64.044,
              lng: -16.181,
              weather: null,
            },
            {
              id: 603,
              time: 'ä¸­åˆï½ä¸‹åˆ',
              place: 'è—å†°æ´æ¢éšª',
              type: 'æ´»å‹•',
              note: 'è·Ÿéš¨å°éŠé€²å…¥å†°æ´ï¼Œé¿å…è‡ªè¡Œèµ°å‹•ï¼Œä¾å¤©å€™èª¿æ•´æ˜¯å¦èƒ½æˆè¡Œã€‚[web:11]',
              lat: 64.05,
              lng: -16.2,
              weather: null,
            },
            {
              id: 604,
              time: 'ä¸‹åˆ',
              place: 'é›·å°¼æ–¯é»‘æ²™ç˜ï¼ˆReynisfjaraï¼‰',
              type: 'æ™¯é»',
              note: 'å¤©ç©ºä¹‹é¡é»‘æ²™ç˜ï¼Œæ³¨æ„ã€Œå·è¥²æµ·æµªã€ï¼Œä¸è¦å¤ªé è¿‘æµ·é‚Šã€‚[web:20]',
              lat: 63.404,
              lng: -19.045,
              weather: null,
            },
            {
              id: 605,
              time: 'å‚æ™šï½æ™šä¸Š',
              place: 'è¿”å›é›·å…‹é›…æœªå…‹å¸‚å€',
              type: 'äº¤é€š',
              note: 'é•·é€”å·´å£«è»Šç¨‹ï¼Œå»ºè­°æº–å‚™é›¶é£Ÿèˆ‡å……é›»è¨­å‚™ã€‚',
              lat: 64.1466,
              lng: -21.9426,
              weather: null,
            },
          ],
        },
        {
          id: 7,
          label: 'Day 7',
          date: '03/02',
          title: 'å†°å³¶ â†’ ç¾…ç“¦æ¶…ç±³',
          items: [
            {
              id: 701,
              time: '07:30',
              place: 'å‰å¾€å‡±å¤«æ‹‰ç¶­å…‹æ©Ÿå ´',
              type: 'äº¤é€š',
              note: 'å»ºè­°ææ—©åˆ°æ©Ÿå ´è¾¦ç†é€€ç¨…èˆ‡è¨—é‹ã€‚',
              lat: 63.985,
              lng: -22.6056,
              weather: null,
            },
            {
              id: 702,
              time: '10:00â€“15:25',
              place: 'å†°å³¶ â†’ èµ«çˆ¾è¾›åŸºï¼ˆHELï¼‰',
              type: 'èˆªç­',
              note: 'é•·ç¨‹èˆªç­ï¼Œç¢ºèªè½‰æ©Ÿæ™‚é–“èˆ‡ç™»æ©Ÿé–€ã€‚',
              lat: 60.3172,
              lng: 24.9633,
              weather: null,
            },
            {
              id: 703,
              time: '19:40â€“21:05',
              place: 'èµ«çˆ¾è¾›åŸº â†’ ç¾…ç“¦æ¶…ç±³ï¼ˆRVNï¼‰',
              type: 'èˆªç­',
              note: 'æ™šé–“åœ‹å…§ç·šï¼Œæ³¨æ„è¡Œææ˜¯å¦ç›´æ›ã€‚',
              lat: 66.5648,
              lng: 25.8304,
              weather: null,
            },
            {
              id: 704,
              time: '21:30â€“ç¿Œæ—¥ 10:00',
              place: 'ç¾…ç“¦æ¶…ç±³å¸‚å€ä½å®¿',
              type: 'ä½å®¿',
              note: 'CHECK-IN å¾Œå¥½å¥½ä¼‘æ¯ï¼Œæº–å‚™éš”å¤©ç§»å‹•åˆ°è–èª•è€äººæ‘ã€‚',
              lat: 66.5039,
              lng: 25.7294,
              weather: null,
            },
          ],
        },
        {
          id: 8,
          label: 'Day 8',
          date: '03/03',
          title: 'ç¾…ç“¦æ¶…ç±³å¸‚å€ï¼‹è–èª•è€äººæ‘',
          items: [
            {
              id: 801,
              time: 'ä¸Šåˆ',
              place: 'ç¾…ç“¦æ¶…ç±³å¸‚å€ï¼å‹•ç‰©åœ’ï¼åšç‰©é¤¨',
              type: 'è‡ªç”±è¡Œç¨‹',
              note: 'å¯è€ƒæ…® Arktikum åŒ—æ¥µåšç‰©é¤¨æˆ–ç•¶åœ°å‹•ç‰©åœ’ï¼Œä¾ç¾å ´å®‰æ’ã€‚[web:18]',
              lat: 66.5039,
              lng: 25.7294,
              weather: null,
            },
            {
              id: 802,
              time: 'ä¸‹åˆ',
              place: 'å‰å¾€è–èª•è€äººæ‘',
              type: 'äº¤é€š',
              note: 'æ­å·´å£«æˆ–æ¥é§å‰å¾€ç´„ 8 å…¬é‡Œå¤–çš„è–èª•è€äººæ‘ã€‚[web:15]',
              lat: 66.5432,
              lng: 25.8472,
              weather: null,
            },
            {
              id: 803,
              time: 'ä¸‹åˆï½æ™šä¸Š',
              place: 'è–èª•è€äººæ‘ Check-in + é€›æ‘èŠ',
              type: 'ä½å®¿',
              note: 'æ‹ç…§ã€è·¨åŒ—æ¥µåœˆã€é€›éƒµå±€èˆ‡ç´€å¿µå“åº—ã€‚',
              lat: 66.5432,
              lng: 25.8472,
              weather: null,
            },
          ],
        },
        {
          id: 9,
          label: 'Day 9',
          date: '03/04',
          title: 'åŒ—æ¥µæ£®æ—æ¢éšªï¼‹æ¥µå…‰è¿½å°‹',
          items: [
            {
              id: 901,
              time: '10:00â€“14:00',
              place: 'åŒ—æ¥µæ£®æ—æ¢éšªï¼ˆå«çƒ¤è‚‰åˆé¤ï¼‰',
              type: 'æ´»å‹•',
              note: 'ä¾è¡Œç¨‹å…§å®¹å¯èƒ½åŒ…å«é›ªé‹ã€é›ªåœ°å¥è¡Œæˆ–é›ªåœ°æ‘©æ‰˜ï¼Œæ³¨æ„ä¿æš–èˆ‡æ‰‹è…³é˜²å‡ã€‚[web:18]',
              lat: 66.5,
              lng: 25.8,
              weather: null,
            },
            {
              id: 902,
              time: '14:00â€“20:00',
              place: 'è‡ªç”±æ™‚é–“ï¼ä¼‘æ¯',
              type: 'ä¼‘æ¯',
              note: 'å›ä½å®¿ä¼‘æ¯ã€æ•´ç†ç…§ç‰‡ï¼Œæº–å‚™æ™šä¸Šçš„æ¥µå…‰åœ˜ã€‚',
              lat: 66.5432,
              lng: 25.8472,
              weather: null,
            },
            {
              id: 903,
              time: '20:00â€“23:00',
              place: 'æ¥µå…‰è¿½å°‹ä¹‹æ—…ï¼ˆå«çƒ¤è‚‰æ™šé¤ï¼‰',
              type: 'æ´»å‹•',
              note: 'å·´å£«æˆ–å°åœ˜å‰å¾€å…‰å®³è¼ƒå°‘åœ°é»è¿½æ¥µå…‰ï¼Œè¨˜å¾—å¸¶è…³æ¶èˆ‡å‚™ç”¨é›»æ± ã€‚[web:6][web:9]',
              lat: 66.7,
              lng: 25.9,
              weather: null,
            },
          ],
        },
        {
          id: 10,
          label: 'Day 10',
          date: '03/05',
          title: 'è–èª•è€äººæ‘æ´»å‹•ï¼‹å¤œèˆ–ç«è»Š',
          items: [
            {
              id: 1001,
              time: '09:00â€“14:00',
              place: 'è–èª•è€äººæ‘ã€å“ˆå£«å¥‡èˆ‡é¦´é¹¿æ¢éšª',
              type: 'æ´»å‹•',
              note: 'å“ˆå£«å¥‡ï¼é¦´é¹¿é›ªæ©‡é«”é©—ï¼‹è–èª•è€äººæ‘æ´»å‹•ï¼Œæ³¨æ„å®‰å…¨åŠä¿æš–ã€‚[web:18]',
              lat: 66.5432,
              lng: 25.8472,
              weather: null,
            },
            {
              id: 1002,
              time: '14:00â€“16:00',
              place: 'è–èª•è€äººæ‘è‡ªç”±æ´»å‹•',
              type: 'è‡ªç”±è¡Œç¨‹',
              note: 'è£œæ‹ç…§ã€è²·ç´€å¿µå“ã€å¯„åŒ—æ¥µåœˆéƒµæˆ³æ˜ä¿¡ç‰‡ã€‚[web:15]',
              lat: 66.5432,
              lng: 25.8472,
              weather: null,
            },
            {
              id: 1003,
              time: '17:00â€“19:00',
              place: 'æ™šé¤',
              type: 'é¤é£Ÿ',
              note: 'åƒé£½å¾Œå›ä½å®¿æ•´ç†è¡Œæï¼Œæº–å‚™æ­å¤œèˆ–ç«è»Šã€‚',
              lat: 66.5039,
              lng: 25.7294,
              weather: null,
            },
            {
              id: 1004,
              time: '19:00â€“21:00',
              place: 'å‰å¾€ç¾…ç“¦æ¶…ç±³ç«è»Šç«™',
              type: 'äº¤é€š',
              note: 'é ç•™æ™‚é–“è¾¦ç†å ±åˆ°èˆ‡æ‰¾æœˆå°ã€‚',
              lat: 66.5039,
              lng: 25.7294,
              weather: null,
            },
            {
              id: 1005,
              time: '21:00â€“ç¿Œæ—¥',
              place: 'VR æ¥µåœ°å¤œèˆ–åˆ—è»Šï¼ˆä¸Šèˆ–ï¼‰',
              type: 'äº¤é€š',
              note: 'æ­å¤œè»Šå‰å¾€èµ«çˆ¾è¾›åŸºï¼Œåˆ—è»Šä¸Šå¯ç°¡å–®ç›¥æ´—èˆ‡ä¼‘æ¯ã€‚[web:16]',
              lat: 65.5,
              lng: 25,
              weather: null,
            },
          ],
        },
        {
          id: 11,
          label: 'Day 11',
          date: '03/06',
          title: 'èµ«çˆ¾è¾›åŸºï¼‹åš•åš•ç±³åšç‰©é¤¨',
          items: [
            {
              id: 1101,
              time: '09:15',
              place: 'æŠµé”èµ«çˆ¾è¾›åŸºè»Šç«™',
              type: 'äº¤é€š',
              note: 'ä¸‹è»Šå¾Œå…ˆæ‰¾ç½®ç‰©æ«ƒæˆ–å‰å¾€é£¯åº—å¯„æ”¾è¡Œæã€‚',
              lat: 60.1719,
              lng: 24.9414,
              weather: null,
            },
            {
              id: 1102,
              time: '09:20â€“10:00',
              place: 'å‰å¾€é£¯åº—æ”¾è¡Œæ',
              type: 'äº¤é€š',
              note: 'è¡Œææ”¾å¥½å³å¯å‡ºé–€æ­ç«è»Šå¾€å¦ä½©é›·ã€‚',
              lat: 60.1719,
              lng: 24.9414,
              weather: null,
            },
            {
              id: 1103,
              time: '10:00â€“15:00',
              place: 'èµ«çˆ¾è¾›åŸº â†” å¦ä½©é›· Â· åš•åš•ç±³åšç‰©é¤¨',
              type: 'è¡Œç¨‹',
              note: 'æ­ VR ç«è»Šå¾€å¦ä½©é›·ï¼Œåƒè§€ Moomin Museum å¾Œå†æ­è»Šè¿”å›ã€‚[web:7][web:16]',
              lat: 61.4981,
              lng: 23.7608,
              weather: null,
            },
            {
              id: 1104,
              time: '15:00â€“',
              place: 'èµ«çˆ¾è¾›åŸºé£¯åº— Check-in',
              type: 'ä½å®¿',
              note: 'è¾¦ç†å…¥ä½ï¼Œè‹¥æœ‰é«”åŠ›å¯æ™šä¸Šç°¡å–®èµ°èµ°å¸‚å€ã€‚',
              lat: 60.1719,
              lng: 24.9414,
              weather: null,
            },
          ],
        },
        {
          id: 12,
          label: 'Day 12',
          date: '03/07',
          title: 'èµ«çˆ¾è¾›åŸºå¸‚å€ï¼‹è¿”å°',
          items: [
            {
              id: 1201,
              time: '11:00',
              place: 'é£¯åº— Check-out',
              type: 'ä½å®¿',
              note: 'é€€æˆ¿å¾Œè¡Œæå¯å¯„æ”¾é£¯åº—æˆ–ç½®ç‰©æ«ƒã€‚',
              lat: 60.1719,
              lng: 24.9414,
              weather: null,
            },
            {
              id: 1202,
              time: '11:00â€“13:00',
              place: 'åˆé¤',
              type: 'é¤é£Ÿ',
              note: 'æ‰¾å¸‚ä¸­å¿ƒé¤å»³äº«ç”¨åˆé¤ï¼Œé †è·¯å®‰æ’ä¸‹ä¸€ç«™æ™¯é»ã€‚',
              lat: 60.1719,
              lng: 24.9414,
              weather: null,
            },
            {
              id: 1203,
              time: '13:00â€“18:00',
              place: 'èµ«çˆ¾è¾›åŸºå¸‚å€è§€å…‰',
              type: 'å¸‚å€',
              note: 'å»ºè­°ï¼šèµ«çˆ¾è¾›åŸºå¤§æ•™å ‚ã€å¸‚å ´å»£å ´ã€å²©çŸ³æ•™å ‚ç­‰ã€‚[web:19]',
              lat: 60.1719,
              lng: 24.9414,
              weather: null,
            },
            {
              id: 1204,
              time: '18:30â€“20:00',
              place: 'æ™šé¤',
              type: 'é¤é£Ÿ',
              note: 'å›é£¯åº—æ‹¿è¡Œæå‰å…ˆåƒé£½ï¼Œé¿å…æ©Ÿå ´å¤ªé¤“ã€‚',
              lat: 60.1719,
              lng: 24.9414,
              weather: null,
            },
            {
              id: 1205,
              time: '20:00â€“20:30',
              place: 'æ‹¿è¡Œæ',
              type: 'å…¶ä»–',
              note: 'å›é£¯åº—æˆ–å¯„ç‰©é»å–å›è¡Œæã€‚',
              lat: 60.1719,
              lng: 24.9414,
              weather: null,
            },
            {
              id: 1206,
              time: '20:30â€“21:30',
              place: 'å¸‚ä¸­å¿ƒ â†’ HEL æ©Ÿå ´',
              type: 'äº¤é€š',
              note: 'æ­æ©Ÿå ´ç«è»Šç´„ 30 åˆ†é˜ï¼Œé ç•™ç­‰è»Šæ™‚é–“ã€‚[web:19]',
              lat: 60.3172,
              lng: 24.9633,
              weather: null,
            },
            {
              id: 1207,
              time: '21:30â€“00:50',
              place: 'èµ«çˆ¾è¾›åŸºæ©Ÿå ´å€™æ©Ÿ',
              type: 'æ©Ÿå ´',
              note: 'è¾¦ç†é€€ç¨…ã€å®‰æª¢èˆ‡ç™»æ©Ÿï¼Œæº–å‚™è¿”å°ã€‚',
              lat: 60.3172,
              lng: 24.9633,
              weather: null,
            },
            {
              id: 1208,
              time: '00:50â€“',
              place: 'èŠ¬è˜­ â†’ å°åŒ—',
              type: 'èˆªç­',
              note: 'é•·ç¨‹å¤œé–“èˆªç­ï¼Œå¯åœ¨æ©Ÿä¸Šæ•´ç†ç…§ç‰‡èˆ‡ä¼‘æ¯ã€‚',
              lat: null,
              lng: null,
              weather: null,
            },
          ],
        },
        {
          id: 13,
          label: 'Day 13',
          date: '03/08',
          title: 'æŠµé”å°åŒ—',
          items: [
            {
              id: 1301,
              time: '22:55',
              place: 'æŠµé”å°åŒ—æ¡ƒåœ’æ©Ÿå ´',
              type: 'æŠµé”',
              note: 'ä¸‹æ©Ÿå¾Œé€šé—œèˆ‡é ˜è¡Œæã€‚',
              lat: 25.0803,
              lng: 121.2327,
              weather: null,
            },
            {
              id: 1302,
              time: '00:00â€“01:00',
              place: 'æ©Ÿå ´æ¥é€å›å®¶',
              type: 'äº¤é€š',
              note: 'é è¨‚æ©Ÿå ´æ¥é€æˆ–è¦ªå‹æ¥æ©Ÿã€‚',
              lat: 25.0478,
              lng: 121.5319,
              weather: null,
            },
            {
              id: 1303,
              time: '01:00â€“',
              place: 'å›åˆ°å®¶',
              type: 'ä¼‘æ¯',
              note: 'çµæŸåŒ—æ­æ—…ç¨‹ï¼Œå¥½å¥½ç¡ä¸€è¦ºã€‚',
              lat: 25.0478,
              lng: 121.5319,
              weather: null,
            },
          ],
        },
      ],

      selectedDayIndex: 0,

      fx: {
        amount: null,
        currency: 'EUR',
        resultTwd: null,
        rates: {
          EUR: 35.0,
          ISK: 0.26,
          SEK: 3.2,
        },
      },

      split: {
        total: null,
        people: 2,
        perPerson: null,
      },

      map: null,
      markersLayer: null,
    };
  },

  computed: {
    currentDay() {
      return this.days[this.selectedDayIndex];
    },
  },

  methods: {
    selectDay(index) {
      this.selectedDayIndex = index;
      if (this.currentTab === 'åœ°åœ–') {
        this.$nextTick(() => this.focusTodayOnMap());
      }
    },

    addDay() {
      const nextId = this.days.length + 1;
      this.days.push({
        id: nextId,
        label: `Day ${nextId}`,
        date: 'æœªè¨­å®š',
        title: 'è‡ªè¨‚è¡Œç¨‹',
        items: [],
      });
      this.selectedDayIndex = this.days.length - 1;
    },

    addItemToSelectedDay() {
      const day = this.currentDay;
      day.items.push({
        id: Date.now(),
        time: '',
        place: '',
        note: '',
        type: 'è¡Œç¨‹',
        lat: null,
        lng: null,
        weather: null,
      });
    },

    removeItemFromSelectedDay(idx) {
      this.currentDay.items.splice(idx, 1);
      if (this.currentTab === 'åœ°åœ–') {
        this.$nextTick(() => this.focusTodayOnMap());
      }
    },

    async fetchWeatherForItem(item) {
      if (!navigator.geolocation && !item.lat) {
        item.weather = { loading: false, temp: 'â€”', summary: 'ç„¡æ³•å–å¾—ä½ç½®è³‡æ–™' };
        return;
      }

      item.weather = { loading: true };

      const getCoords = () =>
        new Promise((resolve, reject) => {
          if (item.lat && item.lng) {
            resolve({ coords: { latitude: item.lat, longitude: item.lng } });
          } else {
            navigator.geolocation.getCurrentPosition(resolve, reject, {
              enableHighAccuracy: true,
              timeout: 5000,
            });
          }
        });

      try {
        const pos = await getCoords();
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;

        item.lat = item.lat || lat;
        item.lng = item.lng || lon;

        // Open-Meteo å…é‡‘é‘°å³æ™‚å¤©æ°£ API ç¤ºæ„ [web:40]
        const url =
          `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}` +
          `&current=temperature_2m,weather_code`;

        const res = await fetch(url);
        const data = await res.json();

        const temp = data?.current?.temperature_2m ?? null;
        const code = data?.current?.weather_code ?? null;

        const summary = this.mapWeatherCodeToText(code);

        item.weather = {
          loading: false,
          temp: temp !== null ? temp.toFixed(1) : 'â€”',
          summary: summary,
        };
      } catch (e) {
        item.weather = {
          loading: false,
          temp: 'â€”',
          summary: 'å¤©æ°£è®€å–å¤±æ•—',
        };
      }
    },

    mapWeatherCodeToText(code) {
      if (code === null || code === undefined) return 'æœªçŸ¥å¤©æ°£';
      if (code === 0) return 'æ™´æœ—';
      if ([1, 2, 3].includes(code)) return 'å¤šé›²';
      if ([45, 48].includes(code)) return 'éœ§';
      if ([51, 53, 55].includes(code)) return 'æ¯›æ¯›é›¨';
      if ([61, 63, 65].includes(code)) return 'ä¸‹é›¨';
      if ([71, 73, 75, 77].includes(code)) return 'ä¸‹é›ª';
      if ([80, 81, 82].includes(code)) return 'é™£é›¨';
      if ([95, 96, 99].includes(code)) return 'é›·é›¨';
      return 'å¤©æ°£å¤šè®Š';
    },

    initMap() {
      this.map = L.map('map').setView([64.1466, -21.9426], 4);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: 'Â© OpenStreetMap',
      }).addTo(this.map);

      this.markersLayer = L.layerGroup().addTo(this.map);

      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (pos) => {
            const { latitude, longitude } = pos.coords;
            L.circleMarker([latitude, longitude], {
              radius: 6,
              color: '#f97316',
              fillColor: '#f97316',
              fillOpacity: 0.9,
            })
              .bindPopup('ä½ ç¾åœ¨çš„ä½ç½®')
              .addTo(this.map);
          },
          () => {},
          { enableHighAccuracy: true, timeout: 5000 }
        );
      }
    },

    focusTodayOnMap() {
      if (!this.map || !this.markersLayer) return;

      this.markersLayer.clearLayers();

      const items = this.currentDay.items.filter((i) => i.place);
      const bounds = [];

      items.forEach((item) => {
        const lat = item.lat ?? 64.1466 + Math.random() * 0.5;
        const lng = item.lng ?? -21.9426 + Math.random() * 0.5;

        const marker = L.marker([lat, lng]).addTo(this.markersLayer);
        marker.bindPopup(
          `<strong>${item.place || 'æœªå‘½ååœ°é»'}</strong><br>${item.time || ''}`
        );

        bounds.push([lat, lng]);

        item.lat = lat;
        item.lng = lng;
      });

      if (bounds.length > 0) {
        this.map.fitBounds(bounds, { padding: [40, 40] });
      }
    },

    convertToTwd() {
      const rate = this.fx.rates[this.fx.currency] || 0;
      if (!this.fx.amount || !rate) {
        this.fx.resultTwd = 0;
        return;
      }
      this.fx.resultTwd = Math.round(this.fx.amount * rate);
    },

    calcSplit() {
      if (!this.split.total || !this.split.people) {
        this.split.perPerson = 0;
        return;
      }
      this.split.perPerson = Math.round(this.split.total / this.split.people);
    },
  },

  mounted() {
    this.$nextTick(() => {
      this.initMap();
      this.focusTodayOnMap();
    });
  },
}).mount('#app');
</script>
</body>
</html>
